$(document).ready(function(){var o;$(document).on("click","#holds-checkouts-button, .available, .pro .list_title, .pro .list_secondary_detail, .pro .book_data, .pro .book, #patron-login",function(){$("#overlay").css({display:"block"})});$(document).on("click","#overlay, .close",function(){$("#overlay").hide();$("#item-info").removeClass("small");$("#item-info").hide().html("");$("#barcode-list").remove()});$("#holds-checkouts").on("click","#holds-checkouts-clear",function(){$.post("/functions/hold-cookie-set.php",{clear:true}).done(function(a){$("#holds-checkouts-inner").load("/functions/holds-active.php",{post:true});$("#holds-checkouts").removeClass("queued")})});$("#holds-checkouts-inner").on("click",".remove",function(){var a=$(this).attr("data");var b=$(this).attr("data-type");var c=$(this).attr("data-barcode");$.post("/functions/hold-cookie-set.php",{remove:true,join_id:a,type:b,barcode_id:c}).done(function(d){$("#holds-checkouts-inner").load("/functions/holds-active.php",{post:true},function(){var e=$("#holds-checkouts-inner div").length;if(e<=0){$("#holds-checkouts").removeClass("queued")}})})});var r=window.location.href;r=r.split("#")[1];if(r&&r.indexOf("X")>=0){var u=r.replace("X","");$.post("/functions/books-info-single.php",{join_id:u}).done(function(a){if($.trim(a).length>0){$("#overlay").css({display:"block"});$("#item-info").show();$("#item-info").html('<div class="close"></div>'+a)}})}$(document).on("click",".book_finds .dlink",function(){$(this).prev(".dlink_input").select();document.execCommand("copy");notification("The link has been copied to your clipboard!","notification_success")});$(document).on("click",".cover-options-button",function(){if($(this).next().is(":hidden")){$(".bottom-book-info").hide();$(this).next().show()}else{$(this).next().hide()}});$(document).mouseup(function(c){var b=$(".cover .bottom-book-info");var a=$(".cover-options-button");if(!b.is(c.target)&&!a.is(c.target)&&b.has(c.target).length===0){b.hide()}});$("#patron-login").on("click",function(){$("#item-info").addClass("small");$("#item-info").show().load("/functions/patron/patron-login.php",{post:true})});$("#item-info").on("keyup",".place-hold .email, .place-hold .token, .generate-password .email-reset-password, #checkout_auth #password",function(b){if(b.which==13){var c=$(this);var a=c.siblings(":button").click()}});$("#item-info").on("click",".submit_patron_login",function(){var c=$(this);var d=true;var e=c.prevAll(".email").val();e=$.trim(e);var a=c.prevAll(".token").val();a=$.trim(a);var b=c.prevAll(".join_id").val();if($.isNumeric(e)&&e.length>=4){c.prevAll(".email").css("background-color","#FFFFFF")}else{if(e=="undefined"||e==""||e.indexOf("@")===-1||e.indexOf(".")===-1){c.prevAll(".email").css("background-color","#FF9494");d=false}else{c.prevAll(".email").css("background-color","#FFFFFF")}}if(a==""||a==undefined){c.prevAll(".token").css("background-color","#FF9494");d=false}else{c.prevAll(".token").css("background-color","#FFFFFF")}if(d){c.prop("disabled",true);$.post("/functions/patron/patron-login-process.php",{email:encodeURIComponent(e),password:encodeURIComponent(a)}).done(function(f){if($.trim(f)=="not found"){notification("Failed to authenticate!","notification_warning")}else{if($.trim(f)=="fail"){notification("Failed to authenticate - bad login!","notification_warning")}else{if($.trim(f)=="success"){window.location.href="/patron"}}}c.prop("disabled",false)})}});$(document).on("click",".pc",function(){var a=$(this);var b=a.closest(".join_class").attr("id").split("_")[1];$.post("/functions/hold-checkout-barcodes.php",{join_id:b}).done(function(c){var c=$.trim(c);if(c=="not-available"){notification("All copies already checked out! ","notification_warning")}else{if(c=="no-items"){notification("There was an error, please refresh and try again! ","notification_warning")}else{if($.isNumeric(c)){$.post("/functions/hold-cookie-set.php",{join_id:b,barcode_id:c}).done(function(f){if($.trim(f)=="max"){notification("This item is already in your queue for checkout!","notification_warning")}else{$("#holds-checkouts").addClass("queued");$("#holds-checkouts-inner").load("/functions/holds-active.php",{post:true});notification("Item added to queue for checkout!","notification_success");setTimeout(function(){$("#holds-checkouts-inner").scrollLeft(5000)},50)}})}else{$("#overlay").css({display:"block"});var d=$.parseJSON(c);var e='<div id="barcode-list">';e+='<div class="barcode-info">Select an available copy to checkout</div><div class="holds-barcode-wrapper">';$.each(d,function(g,f){e+='<div class="holds-barcode" data-barcode-id="'+g+'" data-join-id="'+b+'">'+f+"</div>"});e+="</div></div>";$("body").prepend(e)}}}})});$(document).on("click",".holds-barcode:not(.disable)",function(){var b=$(this);$(".holds-barcode").addClass("disable");var a=b.attr("data-join-id");var c=b.attr("data-barcode-id");$.post("/functions/hold-cookie-set.php",{join_id:a,barcode_id:c}).done(function(d){if($.trim(d)=="max"){notification("This item is already in your queue for checkout!","notification_warning");$(".holds-barcode").removeClass("disable")}else{$("#overlay").click();$("#holds-checkouts").addClass("queued");$("#holds-checkouts-inner").load("/functions/holds-active.php",{post:true});setTimeout(function(){$("#holds-checkouts-inner").scrollLeft(5000)},50)}})});$(document).on("click",".ph",function(){var a=$(this);var b=a.closest(".join_class").attr("id").split("_")[1];$.post("/functions/hold-cookie-set.php",{join_id:b}).done(function(c){if($.trim(c)=="max"){notification("Can not place more holds than there are copies of an item!","notification_warning")}else{$("#holds-checkouts").addClass("queued");$("#holds-checkouts-inner").load("/functions/holds-active.php",{post:true});notification("Item added to queue for hold!","notification_success");setTimeout(function(){$("#holds-checkouts-inner").scrollLeft(5000)},50)}})});$("#holds-checkouts").on("click","#holds-checkouts-button",function(){$("#item-info").addClass("small");$("#item-info").show().load("/functions/request-hold.php",{post:true})});$(".inner-wrapper").scroll(function(e){var b=parseInt($("#more").attr("class"));if($(this).scrollTop()+$(this).innerHeight()+250>=$("#lib_home").outerHeight(true)&&!isNaN(b)){var f=$("#uri").val();var d=$("#more_search_term").val();var h=$.trim($(".hide_first_letter:last").text());var a=$.trim($(".group_heading:last").text());var g=$("#letter_range .active").attr("id");var c=null;if(d!=undefined){d=d.replace("&quot;",'"')}if(g!=undefined){g=g.replace("_",".")}if(g=="number"){g="number"}else{if(g=="all"){g="all"}else{if(parseFloat(g)>0&&g.length<=3){g=parseFloat(g)}else{if(parseInt(g)>0&&g.length==4){g=parseInt(g)}else{if(g!=""&&g!=undefined){var g=g.charAt(g.length-1)}else{g="all"}}}}}$("#more").remove();if($(".search_results").length>0){if($("#lib").prop("checked")){c=$("#lib").val()}$.ajax({type:"POST",url:"/functions/search.php",data:{q:encodeURIComponent(d),limit:encodeURIComponent(b),lib:encodeURIComponent(c)}}).done(function(i){$("#library_load_inner").append(i)})}else{$.ajax({type:"POST",url:"/functions/items-list.php",timeout:3000,data:{uri:encodeURIComponent(f),limit:encodeURIComponent(b),letter_heading:encodeURIComponent(h),group_heading:encodeURIComponent(a),letter:encodeURI(g)}}).done(function(i){$("#library_load_inner").append(i)}).fail(function(k,i,j){$.ajax(this).done(function(l){$("#library_load_inner").append(l)})})}}});$("#letter_range").on("click",".letter, .rating, .year_added, .ddc",function(){$("#letter_range .letter, #letter_range .rating, #letter_range .year_added, #letter_range .ddc").each(function(){$(this).removeClass("active")});var a=$("#uri").val();var b=$(this).attr("id");b=b.replace("_",".");$(this).addClass("active");if(b=="number"){b="number"}else{if(b=="all"){b="all"}else{if(parseFloat(b)>0&&b.length<=3){b=parseFloat(b)}else{if(parseInt(b)>0&&b.length==4){b=parseInt(b)}else{if(b!=""&&b!="undefined"){b=b.charAt(b.length-1)}else{b="all"}}}}}$.ajax({type:"POST",url:"/functions/items-list.php",data:{letter:encodeURIComponent(b),uri:encodeURIComponent(a)}}).done(function(c){$("#library_load_inner").hide().html(c).fadeIn()})});$("#library_load").on("click",".pro .list_title, .pro .list_secondary_detail, .pro .book_data, .pro .book",function(){var a=$(this);var b=a.closest(".join_class").attr("id").split("_")[1];$.post("/functions/books-info-single.php",{join_id:b}).done(function(c){$("#item-info").show();$("#item-info").html('<div class="close"></div>'+c)})});$(document).on("click",".available",function(){var a=$(this);var b=a.closest(".join_class").attr("id").split("_")[1];$.post("/functions/checked-out.php",{join_id:b}).done(function(c){$("#item-info").addClass("small");$("#item-info").show();$("#item-info").html(c)})});$("#item-info").on("click",".forgot_password",function(){$("#item-info").load("/functions/forgot-patron-password.php")});$("#item-info").on("click",".email_pass",function(){$this=$(this);var a=true;var b=$this.prev(".email-reset-password").val();b=$.trim(b);if(b=="undefined"||b==""||b.indexOf("@")===-1||b.indexOf(".")===-1){$this.prev(".email-reset-password").css("background-color","#FF9494");a=false}else{$this.prev(".email-reset-password").css("background-color","#FFFFFF")}if(a){$this.prop("disabled",true);$.post("/functions/forgot-patron-password-process.php",{email:encodeURIComponent(b)}).done(function(c){if($.trim(c)=="success"){notification("Email sent! Check your junk folder if you do not receive it shortly.","notification_success");$("#item-info .close").click()}else{notification("Patron email not found.","notification_warning")}$this.prop("disabled",false)})}});$(document).on("click",".submit_hold",function(){var c=$(this);var d=true;var a=c.prevAll(".email").val();a=$.trim(a);var b=c.prevAll(".token").val();b=$.trim(b);if($.isNumeric(a)&&a.length>=4){c.prevAll(".email").css("background-color","#FFFFFF")}else{if(a=="undefined"||a==""||a.indexOf("@")===-1||a.indexOf(".")===-1){c.prevAll(".email").css("background-color","#FF9494");d=false}else{c.prevAll(".email").css("background-color","#FFFFFF")}}if(b==""||b==undefined){c.prevAll(".token").css("background-color","#FF9494");d=false}else{c.prevAll(".token").css("background-color","#FFFFFF")}if(d){c.prop("disabled",true);$.post("/functions/request-hold-process.php",{email:encodeURIComponent(a),password:encodeURIComponent(b)}).done(function(e){if($.trim(e)=="success"){notification("Checkout/Holds placed successfully!","notification_success");$("#item-info .close").click();$("#holds-checkouts-clear").click()}else{if($.trim(e)=="no find"){notification("Failed to authenticate!","notification_warning")}else{if($.trim(e)=="bad email"){notification("Failed to authenticate!","notification_warning")}else{if($.trim(e)=="hold exists"){notification("You've already placed some of these items on hold!","notification_warning")}else{if($.trim(e)=="not-available"){notification("Some items are already checked out!","notification_warning")}else{notification("There was an error, please try again!","notification_warning")}}}}}c.prop("disabled",false)})}});$("#social_feed_scroll").on("click","#more_posts",function(){var a=$(this).attr("class");$("#more_posts").remove();$.ajax({type:"POST",url:"/functions/social-feed.php",data:"limit="+encodeURIComponent(a)}).done(function(b){$("#social_feed_scroll").append(b)})});$("#tags_list").on("keyup","input#tag-filter",function(a){if(a.which!==13){clearTimeout(o);o=setTimeout(t,200,a)}});function t(c){var b=$("input#tag-filter");var a=$.trim(b.val());a=a.toLowerCase();if(a.length>0){$("#tags_sorted_list li").each(function(d){var e=$(this).text().toLowerCase();if(e.indexOf(a)>=0){$(this).removeClass("hide")}else{$(this).addClass("hide")}})}else{$("#tags_sorted_list li").removeClass("hide")}}$("#tags_quick_list").on("click",function(){var b=$(this).attr("class");var a=null;if($("#lib").prop("checked")){a=$("#lib").val()}$("#tags_list").load("/functions/tags-quick-list.php",{uri:b,lib:a});$("#tags_list").toggleClass("slide-in")});$("#tags_list").on("click",".close",function(){$("#tags_list").removeClass("slide-in")});$("#lib").on("click",function(){$("#tags_list").removeClass("slide-in")});$(document).on("click","span.show_more",function(){$(this).parent().hide();$(this).parent().next(".book_description_full").show()});$(document).on("click","span.show_less",function(){$(this).parent().hide();$(this).parent().prev(".book_description").show()});$(document).on("click",".tag_button, #tags_list li",function(){var a=$(this).text();var c="tag: "+a;var b=null;if($(this).closest("#item-info").length>0){$(".close").click()}if($("#lib").prop("checked")){b=$("#lib").val()}$("#public_search").val("tag: "+a);$("#letter-range-holder, #lib_active").css("display","none");$("#library_load_inner").html('<div id="search_loader"><img src="/images/ajax-loader.gif" alt="loading"></div>');$("#library_load_inner").load("/functions/search.php",{q:c,lib:b})});$(document).on("click",".lexile",function(){var b=$(this).text();var a="lexile: "+b;var c=null;if($(this).closest("#item-info").length>0){$(".close").click()}if($("#lib").prop("checked")){c=$("#lib").val()}$("#public_search").val("lexile: "+b);$("#letter-range-holder, #lib_active").css("display","none");$("#library_load_inner").html('<div id="search_loader"><img src="/images/ajax-loader.gif" alt="loading"></div>');$("#library_load_inner").load("/functions/search.php",{q:a,lib:c})});$("#public_search").on("keyup",function(d){var e=$(this);var b=d.which;if(b===13){var a=e.val();var c=null;if($("#lib").prop("checked")){c=$("#lib").val()}$("#letter-range-holder, #lib_active").css("display","none");$("#library_load_inner").html('<div id="search_loader"><img src="/images/ajax-loader.gif" alt="loading"></div>');$("#library_load_inner").load("/functions/search.php",{q:a,lib:c})}});$(".lib_sort_by").on("change",".sort_select",function(){var a=$(this).val();var b=$("#uri").val();var c=$("#letter_range .active").attr("id");c=c.replace("_",".");if(c=="number"){c="number"}else{if(c=="all"){c="all"}else{if(parseFloat(c)>0&&c.length<=3){c=parseFloat(c)}else{if(parseInt(c)>0&&c.length==4){c=parseInt(c)}else{if(c!=""&&c!="undefined"){c=c.charAt(c.length-1)}else{c="all"}}}}}$.post("/functions/set-sort.php",{sort_by:a}).done(function(d){$("#letter_range").load("/functions/directory.php",{uri:b,sort_by:a});$("#letter_range").find("#all").click()})});$("#asc_desc").on("click",function(){var a=$(this).attr("class");if(a=="DESC"){a="ASC"}else{a="DESC"}var b=$("#letter_range .active").attr("id");b=b.replace("_",".");if(b=="number"){b="number"}else{if(b=="all"){b="all"}else{if(parseFloat(b)>0&&b.length<=3){b=parseFloat(b)}else{if(parseInt(b)>0&&b.length==4){b=parseInt(b)}else{if(b!=""&&b!="undefined"){b=b.charAt(b.length-1)}else{b="all"}}}}}$(this).attr("class",a);var c=$("#uri").val();$.post("/functions/set-asc-desc.php",{asc_desc:a,letter:encodeURIComponent(b)}).done(function(d){$("#letter_range").find("#all").click()})});$(window).resize(function(){var a=$(".inner-wrapper").width()-9;$(".letter_range_fixed, .public_search_fixed").css({width:a,left:220})});var q=$(".mobile").css("display")=="none";q=true;$(".inner-wrapper").scroll(function(c){var b=$(this).scrollTop();if(b>=100&&q){$("#public_search").addClass("fixed");$("#public_search").addClass("public_search_fixed");$("#letter_range").addClass("fixed");$("#letter_range").addClass("letter_range_fixed");if($("#public_search").length<=0){$("#letter_range").addClass("letter_top")}var a=$(".inner-wrapper").width();$(".letter_range_fixed, .public_search_fixed").css({width:a,left:220})}else{$(".letter_range_fixed, .public_search_fixed").css({width:"100%",left:"0"});$("#letter_range").removeClass("fixed");$("#letter_range").removeClass("letter_range_fixed");$("#letter_range").removeClass("letter_top");$("#public_search").removeClass("fixed");$("#public_search").removeClass("public_search_fixed")}});function s(){return"ontouchstart" in window||"onmsgesturechange" in window}var x=s();var p=$(".mobile-menu-button");var n=$(".mobile-menu");if(x==true){p.on("touchend",function(){n.toggle();return false})}else{p.on("click",function(){n.toggle();return false})}var v=$(window).width();$(window).resize(function(){v=$(window).width();if(v>599){n.show()}else{n.hide()}});var w=false;$(".left-menu").bind("touchstart click",function(){if(!w){w=true;setTimeout(function(){w=false},100);$("#second-sidebar").removeClass("show-sidebar");$("#first-sidebar").toggleClass("show-sidebar")}return false});var m=false;$(".right-menu").bind("touchstart click",function(){if(!m){m=true;setTimeout(function(){m=false},100);$("#first-sidebar").removeClass("show-sidebar");$("#second-sidebar").toggleClass("show-sidebar")}return false})});